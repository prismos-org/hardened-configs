#
# KERNEL ARGS
#

# Kernel Self Protection

slab_nomerge # Disable slab merging
page_alloc.shuffle=1 # Randomize the page allocators freelist.
module.sig_enforce=1 # Only allow kernel modules that have been signed with a valid key to be loaded
pti=on # Enable kernel page isolation
vsyscall=none # Disables vsyscalls
ia32_emulation=0 # Disable 32 bit emulation
randomize_kstack_offset=on # Randomizes the kernel stack offset on each syscall
lockdown=confidentiality # See kernel_lockdown(7)
oops=panic # Panic on oops

## Zero memory during allocation and on free.
init_on_alloc=1
init_on_free=1

## Information leakage reduction
quiet
splash
loglevel=0
plymouth.nolog=1
debugfs=off

## Do not trust the CPU or the bootloader to provide entropy.
random.trust_cpu=off 
random.trust_bootloader=off 

## CPU Vulnerabilities Mitigations
mitigations=auto,nosmt
nosmt=force # Slows the machine down!
spec_store_bypass_disable=on
tsx=off
kvm.nx_huge_pages=force
l1d_flush=on
spec_rstack_overflow=safe-ret
gather_data_sampling=force
reg_file_data_sampling=on
spectre_v2=on
spectre_bhi=on

## Enable IOMMU
intel_iommu=on 
amd_iommu=force_isolation
efi=disable_early_pci_dma # Unstable!
iommu=force
iommu.passthrough=0
iommu.strict=1
